# 声明
**本项目仅学习交流使用，切勿将其用于违法犯罪！请于下载后24小时内删除！本人不对该项目造成的任何后果负责**

# 程序逻辑
- 手动截屏或用户手动复制所有题目，创建`questions.ini`，其内容为：  

        [3-11] # 绝对题号（大题-小题）
        id = 90 # 截取顺序号
        relativeid = 11 # 相对题号（小题号）
        question = XXX # 问题
        type = 2 # 0: 单选，1: 多选，2: 判断
        
- 读取`questions.ini`，并且根据`threadNum`创建对应数量线程搜索题目，以字典形式保存在全局变量`__questionList`中，在全部搜索完之后保存到`answers.ini`中，格式同上。并且，每道题如果搜索不到，还会尝试变化形式重新搜索（总共4次），搜索不到会粘贴并按`回车`键（默认场景是鼠标已经定位在某微信搜题公众号的聊天框中）；如果搜索到，则将此题从`questions.ini`中移除。
- 搜索完成后，使用`push(message)`方法推送给用户，使用`MessageSender`中的方法，有Bark、ServerChan、SMTP、控制台、文件等方法。其中，`message`为字典，格式为：`{'no': 题号, 'question': 题目题干, 'answer': 题目答案}`（可直接使用`__questionList`或`answers.ini`中的字典）
- 需要注意，在`__questionList`或`answers.ini`中，`\n`作为`\1`保存，使用时需替换。
- `answer.ini`内容为：
        [1-10] # 绝对题号（大题-小题）
        id = 10 # 搜索顺序号
        relativeid = 10 # 相对题号（小题号）
        question = xxx # 问题
        answer = I. : xxx#II. : xxx\1 # 答案。其中I、II为API顺序，主程序中有一个数组用于储存罗马数字，不够可以加。

# 使用方法
进入程序后，首先选择是否为搜题模式，默认为不选择，然后选择是否为紧急模式，默认不选择。接下来如果用户使用OCR模式，则需要截取总题号（下方形如1/100字样），并且需要把摄像头画面置于左上角，之后截图截取题目（带题号）及A选项即可，或者截取全图；如果使用复制模式，则需要修改350行左右的两行代码（`initFlag = False`和`numOfQuestions = 总题号`），之后复制题号及题目即可。
  
# 紧急模式
如果用户陷入危急中（指只可复制，其它方法都无法使用），可使用此模式进行题目搜索，此时不分题号，复制一道搜索并显示一道。

# 搜题模式
如果用户希望搜索某些题，则可创建`questions1.ini`文件，程序会自动搜索`questions1.ini`中的题目并向`answers.ini`中添加答案。

# 题目获取
- 安卓端与电脑adb连接后使用universal copy复制后可直接同步到电脑剪切板
- 全设备可截图后（投屏截图也可以）使用腾讯OCR获取题目文本

# 性能
实测在i5-9400F、200Mbps公网带宽的机器上，6线程搜索100题仅需20多秒，准确率虽然受API影响，但高达90%以上，这归功于题目截取搜索，如果算上最后采用的公众号，准确率高达98%。

# 备注及待办事项
- **已知：傲软投屏有时会和代码互相占用剪切板导致傲软无法写入剪切板，解决办法：先开投屏截一张图，再开程序。** 
- [x] 如果要加入忽略用户截图顺序的功能，首先要改变`__questionList`的排序方式，变为1,11,12这样的排序（把`int()`去掉即可)  
- [x] 其次在检测问题类型的时候，检测一下前面的大题题号（可选）。  
- [X] 增加一个选项，可以直接查询`question.ini`里面的题，这要求`question.ini`在删除前需要复制为`question1.ini`。  
- [X] 关键字优化（连接错误以及无答案时按照标点截短后文字重搜、第一次先保留括号如果四个均无答案则去掉括号重搜）  
- [X] 显示优化  
- [X] 引擎优化（多线程）  
- [X] 数据库引入：没有查到的题录入待查数据库，稍后利用其它线程重新查询  
- [X] 可以考虑先浏览一遍所有题，分别截图保存到不同文件中，再开双线程进行OCR和查题，最后按照题号输出，这样会快很多  
- [X] 运行前提示用户选择，手动搜题模式实时显示答案，不需要进行文本处理。  
- [X] 寻求更多可靠的题库API  
- [X] 对半砍题干可以提高搜索成功率  
- [X] ~~将主程序中的文字处理函数封装成类（弃用，依赖关系太复杂，得不偿失）~~

# 项目结构
- main.py
主程序，负责处理主逻辑和文本部分。  
  
- Exceptions.py
异常类，定义了3个自定义异常。  
  
- getter.py
API封装类，如果想添加自己的API可以仿照扩写（由于Python没有限制传入参数，稍加修改此程序可搜图片题）。  
  
- OcrApis.py
OCR API封装类，内有百度和腾讯API，理论上可以使用多API，实测发现效率很低，而且百度API在较低分辨率（其实不低，720P）下识别不准，故只采用腾讯API。同样可扩写使用其他API。
